<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.2">
<title>Charleston International Airport</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,alt.7f878b97.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,alt.7f878b97.css">
<link rel="modulepreload" href="./_observablehq/client.e369bcc0.js">
<link rel="modulepreload" href="./_observablehq/runtime.f168f711.js">
<link rel="modulepreload" href="./_observablehq/stdlib.a7574edc.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.e369bcc0.js";

define({id: "5f588f40", outputs: ["Plot","airlines","locations","getData","filterFlights","fetchFlightData"], body: async () => {
const Plot = await import("./_npm/@observablehq/plot@0.6.16/e828d8c8.js");

const airlines = [
  {
    code: "AA",
    name: "American Airlines",
  },
  {
    code: "AS",
    name: "Alaska",
  },
  {
    code: "G4",
    name: "Allegiant",
  },
  {
    code: "XP",
    name: "Avelo",
  },
  {
    code: "MX",
    name: "Breeze Airways",
  },
  {
    code: "DL",
    name: "Delta",
  },
  {
    code: "F9",
    name: "Frontier",
  },
  {
    code: "B6",
    name: "JetBlue",
  },
  {
    code: "3M",
    name: "Silver",
  },
  {
    code: "WN",
    name: "Southwest",
  },
  {
    code: "SY",
    name: "Sun Country",
  },
  {
    code: "UA",
    name: "United Airlines",
  },
  {
    code: "NK",
    name: "Spirit",
  },
  {
    code: "AC",
    name: "Air Canada",
  },
];

const locations = [
  {
    code: "CHS",
    name: "Charleston",
  },
  {
    code: "ATL",
    name: "Atlanta",
  },
  {
    code: "SEA",
    name: "Seattle",
  },
  {
    code: "CVG",
    name: "Cincinnati",
  },
  {
    code: "LCK",
    name: "Columbus",
  },
  {
    code: "IND",
    name: "Indianapolis",
  },
  {
    code: "SDF",
    name: "Louisville",
  },
  {
    code: "PIT",
    name: "Pittsburgh",
  },
  {
    code: "BLV",
    name: "St. Louis",
  },
  {
    code: "CLT",
    name: "Charlotte",
  },
  {
    code: "ORD",
    name: "Chicago",
  },
  {
    code: "DFW",
    name: "Dallas/Forth Worth",
  },
  {
    code: "PHL",
    name: "Philadelphia",
  },
  {
    code: "MIA",
    name: "Miami",
  },
  {
    code: "DCA",
    name: "Washington, D.C.",
  },
  {
    code: "HVN",
    name: "New Haven",
  },
  {
    code: "CAK",
    name: "Akron/Canton",
  },
  {
    code: "CMH",
    name: "Columbus",
  },
  {
    code: "RSW",
    name: "Fort Myers",
  },
  {
    code: "BDL",
    name: "Hartford",
  },
  {
    code: "ISP",
    name: "Islip",
  },
  {
    code: "LAS",
    name: "Las Vegas",
  },
  {
    code: "SDF",
    name: "Louisville",
  },
  {
    code: "MSY",
    name: "New Orleans",
  },
  {
    code: "ORF",
    name: "Norfolk",
  },
  {
    code: "MCO",
    name: "Orlando",
  },
  {
    code: "PFD",
    name: "Providence",
  },
  {
    code: "RIC",
    name: "Richmond",
  },
  {
    code: "SFO",
    name: "San Francisco",
  },
  {
    code: "SYR",
    name: "Syracuse",
  },
  {
    code: "TPA",
    name: "Tampa",
  },
  {
    code: "HPN",
    name: "Westchester, NY",
  },
  {
    code: "PBI",
    name: "West Palm Beach",
  },
  {
    code: "BOS",
    name: "Boston",
  },
  {
    code: "DTW",
    name: "Detroit",
  },
  {
    code: "LGA",
    name: "New York City",
  },
  {
    code: "JFK",
    name: "New York City",
  },
  {
    code: "MSP",
    name: "Minneapolis",
  },
  {
    code: "DEN",
    name: "Denver",
  },
  {
    code: "FLL",
    name: "Fort Lauderdale",
  },
  {
    code: "LAX",
    name: "Los Angeles",
  },
  {
    code: "AUS",
    name: "Austin",
  },
  {
    code: "BWI",
    name: "Baltimore",
  },
  {
    code: "MDW",
    name: "Chicago",
  },
  {
    code: "DAL",
    name: "Dallas",
  },
  {
    code: "HOU",
    name: "Houston",
  },
  {
    code: "MCI",
    name: "Kansas City",
  },
  {
    code: "BNA",
    name: "Nashville",
  },
  {
    code: "STL",
    name: "St. Louis",
  },
  {
    code: "IAH",
    name: "Houston",
  },
  {
    code: "EWR",
    name: "Newark",
  },
  {
    code: "IAD",
    name: "Washington, D.C.",
  },
  {
    code: "PNS",
    name: "Pensacola",
  },
  {
    code: "SAT",
    name: "San Antonio",
  },
  {
    code: "COS",
    name: "Colorado Springs",
  },
  {
    code: "PHX",
    name: "Phoenix",
  },
  {
    code: "PVD",
    name: "Providence",
  },
  {
    code: "PVU",
    name: "Provo",
  },
  {
    code: "TYS",
    name: "Jacksonville",
  },
  {
    code: "ABE",
    name: "Allentown",
  },
  {
    code: "OMA",
    name: "Omaha",
  },
  {
    code: "TRI",
    name: "Bristol/Johnson/Kingsp",
  },
  {
    code: "ABQ",
    name: "Albuquerque",
  },
  {
    code: "ALB",
    name: "Albany",
  },
  {
    code: "BHM",
    name: "Birmingham",
  },
  {
    code: "BRL",
    name: "Burlington",
  },
  {
    code: "BTR",
    name: "Baton Rouge",
  },
  {
    code: "BUF",
    name: "Buffalo",
  },
  {
    code: "CAE",
    name: "Columbia",
  },
  {
    code: "CID",
    name: "Cedar Rapids",
  },
  {
    code: "CLE",
    name: "Cleveland",
  },
  {
    code: "CRP",
    name: "Corpus Christi",
  },
  {
    code: "DAY",
    name: "Dayton",
  },
  {
    code: "DSM",
    name: "Des Moines",
  },
  {
    code: "ELP",
    name: "El Paso",
  },
  {
    code: "EVV",
    name: "Evansville",
  },
  {
    code: "FWA",
    name: "Fort Wayne",
  },
  {
    code: "GRR",
    name: "Grand Rapids",
  },
  {
    code: "GSO",
    name: "Greensboro/High Point",
  },
  {
    code: "GSP",
    name: "Greenville/Spartanburg",
  },
  {
    code: "HSV",
    name: "Huntsville",
  },
  {
    code: "JAX",
    name: "Jacksonville",
  },
  {
    code: "LFT",
    name: "Lafayette",
  },
  {
    code: "LIT",
    name: "Little Rock",
  },
  {
    code: "LRD",
    name: "Laredo",
  },
  {
    code: "MBS",
    name: "Saginaw/Midland/Bay C.",
  },
  {
    code: "MDT",
    name: "Harrisburg",
  },
  {
    code: "MEM",
    name: "Memphis",
  },
  {
    code: "MFE",
    name: "McAllen/Mission",
  },
  {
    code: "MGM",
    name: "Montgomery",
  },
  {
    code: "MKE",
    name: "Milwaukee",
  },
  {
    code: "MLI",
    name: "Moline",
  },
  {
    code: "MOB",
    name: "Mobile",
  },
  {
    code: "OKC",
    name: "Oklahoma City",
  },
  {
    code: "PDX",
    name: "Portland",
  },
  {
    code: "RDU",
    name: "Raleigh/Durham",
  },
  {
    code: "ROC",
    name: "Rochester",
  },
  {
    code: "SAN",
    name: "San Diego",
  },
  {
    code: "SBN",
    name: "South Bend",
  },
  {
    code: "SHV",
    name: "Shreveport",
  },
  {
    code: "SLC",
    name: "Salt Lake City",
  },
  {
    code: "SMF",
    name: "Sacramento",
  },
  {
    code: "SWF",
    name: "New York",
  },
  {
    code: "TOL",
    name: "Toledo",
  },
  {
    code: "TUL",
    name: "Tulsa",
  },
  {
    code: "TUS",
    name: "Tucson",
  },
  {
    code: "TVC",
    name: "Traverse City",
  },
  {
    code: "YUL",
    name: "Montreal",
  },
  {
    code: "YYZ",
    name: "Toronto",
  },
  {
    code: "PWM",
    name: "Portland",
  },
  {
    code: "MHT",
    name: "Manchester",
  },
];

async function getData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
    }
    const data = await response.json();
    return data.data;
  } catch (error) {
    console.error(error.message);
    return null;
  }
}

function filterFlights(flights, flightType, airlines) {
  return flights.filter((flight) => {
    const airline = flight.carrierCode?.iata;
    const serviceType = flight.serviceTypeCode?.iata;
    if (!airline || !flight.statusDetails?.[0]) return false;

    if (
      (airline === "AC" &&
        flightType === "arrival" &&
        flight.departure.airport.iata !== "YYZ") ||
      (airline === "UA" &&
        flightType === "departure" &&
        flight.arrival.airport.iata === "YYZ") ||
      serviceType !== "J"
    ) {
      return false;
    }

    if (flight.codeshare?.comment050?.code) {
      const codeshareAirline = flight.codeshare.comment050.code;
      if (
        codeshareAirline !== "AC" &&
        airlines.some((a) => a.code === codeshareAirline)
      ) {
        return false;
      }
    }

    return true;
  });
}

async function fetchFlightData() {
  const arrivalData = await getData(
    "https://ccaafids.azurewebsites.net/api/FIDsTest?code=VnSepGuKSiEXD0zW_eOg73NkKKgyT_jDIZOm8pvuCbs8AzFuNZG1RA==&dir=arrival"
  );

  if (!arrivalData) {
    console.error("No arrival data available");
    return;
  }

  const arrivals = filterFlights(arrivalData, "arrival", airlines);

  const departureData = await getData(
    "https://ccaafids.azurewebsites.net/api/FIDsTest?code=VnSepGuKSiEXD0zW_eOg73NkKKgyT_jDIZOm8pvuCbs8AzFuNZG1RA==&dir=departure"
  );

  if (!departureData) {
    console.error("No departure data available");
    return;
  }

  const departures = filterFlights(departureData, "departure", airlines);

  // mapping data
  const mapData = (flight, type) => {
    const airline = airlines.find(
      (airline) => airline.code === flight.carrierCode?.iata
    );

    const statusDetails = flight.statusDetails?.[0];
    const statusObj = statusDetails
      ? type === "arrival"
        ? statusDetails.arrival
        : statusDetails.departure
      : null;

    const timeliness = statusDetails
      ? type === "arrival"
        ? statusDetails.arrival.estimatedTime.inGateTimeliness
        : statusDetails.departure.estimatedTime.outGateTimeliness
      : null;

    const city = statusDetails
      ? type === "arrival"
        ? statusDetails.departure.airport.iata
        : statusDetails?.arrival.airport.iata
      : null;

    const cityName = locations.find((location) => location.code === city)?.name;

    return {
      airlineName: airline ? airline.name : null,
      flightNumber: flight.flightNumber || null,
      city: cityName,
      timeliness: timeliness,
      aircraftRegistrationNumber:
        statusDetails.equipment.aircraftRegistrationNumber,
      aircraftType: statusDetails.equipment.actualAircraftType.icao,
      gate: statusObj.gate,
      status: statusObj,
      type,
    };
  };

  const combinedFlights = [
    ...arrivals.map((flight) => mapData(flight, "arrival")),
    ...departures.map((flight) => mapData(flight, "departure")),
  ];

  const totalFlights = combinedFlights.length;
  document.getElementById("totalFlights").innerText = `${totalFlights}`;

  const totalArrivals = combinedFlights.filter(
    (flight) => flight.type === "arrival"
  ).length;
  document.getElementById("totalArrivals").innerText = `${totalArrivals}`;

  const totalDepartures = combinedFlights.filter(
    (flight) => flight.type === "departure"
  ).length;
  document.getElementById("totalDepartures").innerText = `${totalDepartures}`;

  // airline chart
  const airlineFlightTypeStackedHorizontalBar = Plot.plot({
    marginLeft: 90,
    x: { label: "Flights" },
    y: { label: null },
    fx: { label: null },
    marks: [
      Plot.barX(
        combinedFlights,
        Plot.groupY(
          { x: "count" },
          {
            fx: "type",
            fill: "type",
            y: "airlineName",
            sort: { y: "x", reverse: true },
            tip: true,
          }
        )
      ),
    ],
  });

  document
    .getElementById("airlinesByFlightType")
    .appendChild(airlineFlightTypeStackedHorizontalBar);

  const airlineFlightTypeAndTimelinessStackedHorizontalBar = Plot.plot({
    marginLeft: 90,
    x: { label: "Flights" },
    color: {
      scheme: "category10",
      legend: true,
      domain: ["OnTime", "Delayed", "Early"],
    },
    y: { label: null },
    fx: { label: null },
    marks: [
      Plot.barX(
        combinedFlights,
        Plot.groupY(
          { x: "count" },
          {
            fx: "type",
            fill: "timeliness",
            y: "airlineName",
            sort: { y: "x", reverse: true },
            tip: true,
          }
        )
      ),
    ],
  });

  document
    .getElementById("airlinesByFlightTypeAndTimeliness")
    .appendChild(airlineFlightTypeAndTimelinessStackedHorizontalBar);

  // display(combinedFlights);
  // display(arrivals);
}

fetchFlightData();
return {Plot,airlines,locations,getData,filterFlights,fetchFlightData};
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link observablehq-link-active"><a href="./">Charleston International Airport</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./about">About</a></li>
    <li class="observablehq-link"><a href="./gate-map">Gate Map</a></li>
    <li class="observablehq-link"><a href="./helper-functions">Helper Functions / Constants</a></li>
    <li class="observablehq-link"><a href="./raw-flights">Raw Flights</a></li>
    <li class="observablehq-link"><a href="./update-loop">Update Loop</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<!-- markdownlint-disable -->
<h1 id="charleston-international-airport" tabindex="-1"><a class="observablehq-header-anchor" href="#charleston-international-airport">Charleston International Airport</a></h1>
<div class="observablehq observablehq--block"><!--:5f588f40:--></div>
<div class="grid grid-cols-4" style="grid-auto-rows: auto;">
  <div class="card">
    <h2>Scheduled Flights Today</h2>
    <span class="big" id="totalFlights"></span>
  </div>
<!-- </div>
<div class="grid grid-cols-4" style="grid-auto-rows: auto;"> -->
  <div class="card">
    <h2>Scheduled Arrivals</h2>
    <span class="big" id="totalArrivals"></span>
  </div>
  <div class="card">
    <h2>Scheduled Departures</h2>
    <span class="big" id="totalDepartures"></span>
  </div>
</div>
<div class="grid grid-cols-2">
  <div class="card" style="display: flex; flex-direction: column; gap: 1rem;">
  <h2>Flights by Airline and Type</h2>
  <span id="airlinesByFlightType"></span>
  </div>
</div>
<div class="grid grid-cols-2">
  <div class="card" style="display: flex; flex-direction: column; gap: 1rem;">
  <h2>Flights by Airline, Timeliness and Type</h2>
  <span id="airlinesByFlightTypeAndTimeliness"></span>
  </div>
</div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-03-08T15:46:33">Mar 8, 2025</a>.</div>
</footer>
</div>
</body>
</html>
