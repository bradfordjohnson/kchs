<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.2">
<title>Charleston International Airport</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/custom-style.7fd960ca.css">
<link rel="preload" as="style" href="./_npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/custom-style.7fd960ca.css">
<link rel="stylesheet" type="text/css" href="./_npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="modulepreload" href="./_observablehq/client.e369bcc0.js">
<link rel="modulepreload" href="./_observablehq/runtime.f168f711.js">
<link rel="modulepreload" href="./_observablehq/stdlib.a7574edc.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_import/config.ddd1b4b5.js">
<link rel="modulepreload" href="./_npm/leaflet@1.9.4/d8a0af43.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.e369bcc0.js";

define({id: "52cf6696", outputs: ["Plot","API_CONFIG","carrierCodes","todaysDate","mapData","chsGates","chsGatePlanes","getData","departureData","arrivalData"], body: async () => {
const [Plot, {API_CONFIG, carrierCodes, todaysDate, mapData, chsGates, chsGatePlanes}] = await Promise.all([import("./_npm/@observablehq/plot@0.6.16/e828d8c8.js"), import("./_import/config.ddd1b4b5.js")]);

async function getData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error(error.message);
  }
}
const departureData = await getData(API_CONFIG.departureUrl);
const arrivalData = await getData(API_CONFIG.arrivalUrl);
return {Plot,API_CONFIG,carrierCodes,todaysDate,mapData,chsGates,chsGatePlanes,getData,departureData,arrivalData};
}});

define({id: "c4a984e5", inputs: ["arrivalData","mapData","departureData","todaysDate","carrierCodes"], outputs: ["arrivals","departures","filteredArrivals","filteredDepartures"], body: (arrivalData,mapData,departureData,todaysDate,carrierCodes) => {
const arrivals = arrivalData.data.map(flight =>  mapData(flight));
const departures = departureData.data.map(flight =>  mapData(flight));

const filteredArrivals = arrivals.filter(item => 
  item.arrivalDate === todaysDate &&
  item.estimatedArrival !== undefined &&
  carrierCodes.includes(item.carrierCode)
);

const filteredDepartures = departures.filter(item => 
  item.departureDate === todaysDate &&
  item.estimatedDeparture !== undefined &&
  carrierCodes.includes(item.carrierCode)
);

return {arrivals,departures,filteredArrivals,filteredDepartures};
}});

define({id: "b6dc4393", mode: "inline", inputs: ["filteredArrivals","display"], body: async (filteredArrivals,display) => {
display(await(
filteredArrivals.length
))
}});

define({id: "b1c49502", mode: "inline", inputs: ["arrivalsWowPercentageChange","display"], body: async (arrivalsWowPercentageChange,display) => {
display(await(
arrivalsWowPercentageChange.toFixed(2)
))
}});

define({id: "e7f0e3f0", mode: "inline", inputs: ["arrivalSparkline","display"], body: async (arrivalSparkline,display) => {
display(await(
arrivalSparkline
))
}});

define({id: "58cc44fe", mode: "inline", inputs: ["filteredDepartures","display"], body: async (filteredDepartures,display) => {
display(await(
filteredDepartures.length
))
}});

define({id: "690fccba", mode: "inline", inputs: ["departuresWowPercentageChange","display"], body: async (departuresWowPercentageChange,display) => {
display(await(
departuresWowPercentageChange.toFixed(2)
))
}});

define({id: "aa732f1e", mode: "inline", inputs: ["departureSparkline","display"], body: async (departureSparkline,display) => {
display(await(
departureSparkline
))
}});

define({id: "952072bf", inputs: ["getData","carrierCodes","filteredArrivals","todaysDate","Plot"], outputs: ["historicalArrivals","combinedArrivals","oneWeekAgo","formattedLastWeek","lastWeekArrivals","arrivalsWowPercentageChange","filteredHistoricalArrivals","arrivalsByDate","todaysArrivals","arrivalSparklineData","arrivalSparkline"], body: async (getData,carrierCodes,filteredArrivals,todaysDate,Plot) => {
const historicalArrivals = await getData("https://raw.githubusercontent.com/bradfordjohnson/kchs/refs/heads/master/data/arrivals.json");

const combinedArrivals = Object.values(historicalArrivals).flat(2);

const oneWeekAgo = new Date();
oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

const formattedLastWeek = oneWeekAgo.toISOString().split("T")[0];

const lastWeekArrivals = combinedArrivals.filter(
  arrival => arrival.arrivalDate === formattedLastWeek &&
  carrierCodes.includes(arrival.icao)
);

const arrivalsWowPercentageChange = ((filteredArrivals.length / lastWeekArrivals.length) - 1) * 100;

const filteredHistoricalArrivals = combinedArrivals.filter(arrival => carrierCodes.includes(arrival.icao));

const arrivalsByDate = filteredHistoricalArrivals.reduce((acc, arrival) => {
  acc[arrival.arrivalDate] = (acc[arrival.arrivalDate] || 0) + 1;
  return acc;
}, {});

const todaysArrivals = {
  date: todaysDate,
  arrivals: filteredArrivals.length
};

const arrivalSparklineData = Object.keys(arrivalsByDate)
  .sort()
  .map(date => ({ date, arrivals: arrivalsByDate[date] }));
arrivalSparklineData.push(todaysArrivals);


const arrivalSparkline = Plot.plot({
  style: {
    display: "inline-block",
    marginBottom: -1,
    overflow: "visible",
    zIndex: 2,
    position: "relative"
  },
  x: { axis: null, type: "point" },
  y: { axis: null },
  width: 150,
  height: 75,
  margin: 1,
  marks: [
    Plot.areaY(arrivalSparklineData, { x: "date", y: "arrivals", fillOpacity: 0.1}),
    Plot.lineY(arrivalSparklineData, { x: "date", y: "arrivals", tip: true})
  ]
});
return {historicalArrivals,combinedArrivals,oneWeekAgo,formattedLastWeek,lastWeekArrivals,arrivalsWowPercentageChange,filteredHistoricalArrivals,arrivalsByDate,todaysArrivals,arrivalSparklineData,arrivalSparkline};
}});

define({id: "2a551b63", inputs: ["getData","formattedLastWeek","carrierCodes","filteredDepartures","todaysDate","Plot"], outputs: ["historicalDepartures","combinedDepartures","lastWeekDepartures","departuresWowPercentageChange","filteredHistoricalDepartures","departuresByDate","todaysDepartures","departureSparklineData","departureSparkline"], body: async (getData,formattedLastWeek,carrierCodes,filteredDepartures,todaysDate,Plot) => {
const historicalDepartures = await getData("https://raw.githubusercontent.com/bradfordjohnson/kchs/refs/heads/master/data/departures.json");

const combinedDepartures = Object.values(historicalDepartures).flat(2);

const lastWeekDepartures = combinedDepartures.filter(
  departure => departure.departureDate === formattedLastWeek &&
  carrierCodes.includes(departure.icao)
);

const departuresWowPercentageChange = ((filteredDepartures.length / lastWeekDepartures.length) - 1) * 100;

const filteredHistoricalDepartures = combinedDepartures.filter(departure => carrierCodes.includes(departure.icao));

const departuresByDate = filteredHistoricalDepartures.reduce((acc, departure) => {
  acc[departure.departureDate] = (acc[departure.departureDate] || 0) + 1;
  return acc;
}, {});

const todaysDepartures = {
  date: todaysDate,
  departures: filteredDepartures.length
};

const departureSparklineData = Object.keys(departuresByDate)
  .sort()
  .map(date => ({ date, departures: departuresByDate[date] }));
departureSparklineData.push(todaysDepartures);

const departureSparkline = Plot.plot({
  style: {
    display: "inline-block",
    marginBottom: -1,
    overflow: "visible",
    zIndex: 2,
    position: "relative"
  },
  x: { axis: null, type: "point" },
  y: { axis: null },
  width: 150,
  height: 75,
  margin: 1,
  marks: [
    Plot.areaY(departureSparklineData, { x: "date", y: "departures", fillOpacity: 0.1}),
    Plot.lineY(departureSparklineData, { x: "date", y: "departures", tip: true})
  ]
});
return {historicalDepartures,combinedDepartures,lastWeekDepartures,departuresWowPercentageChange,filteredHistoricalDepartures,departuresByDate,todaysDepartures,departureSparklineData,departureSparkline};
}});

define({id: "a5d4d7c8", inputs: ["display","chsGatePlanes"], outputs: ["L","div","map","early","late","hidden"], body: async (display,chsGatePlanes) => {
const L = await import("./_npm/leaflet@1.9.4/d8a0af43.js");

const div = display(document.createElement("div"));
div.style = "height: 450px;";



const map = L.map(div,  { zoomControl: true, scrollWheelZoom: false, dragging: true })
  .setView([32.885636, -80.036886], 18);

L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
})
  .addTo(map);

// Object.entries(chsGates).forEach(([gate, coords]) => {
//   L.circle(coords, {
//     radius:  4,
//     color: "green"
//   })
//   .addTo(map)
//   .bindPopup(`<b>Gate: ${gate}</b>`);
// });

// var svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
// svgElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="294.728 -842.512 1642 1515">
// 	<path d="m1908.1019-252.4527q-67.6116-54.7508-277.1752-32.7248l-337.552 35.4781-489.7581-580.6049-4.0336-4.5531q-10.88-8.8105-23.5382-7.48L686.031-832.8766q-12.6582 1.3304-21.4687 12.2105-13.2157 16.3201-4.2618 33.8651L934.7258-212.0038 590.1416-175.7867Q447.9746-378.4109 437.0945-387.2213 426.2146-396.0319 413.5563-394.7013L323.5426-385.2405Q310.8843-383.9101 302.0738-373.0301 290.746-359.0415 296.8871-341.2008L416.9433-44.5335 361.1913 270.612q-3.7041 18.8754 11.0617 30.8324 10.88 8.8105 23.5382 7.48l90.791-8.8315q12.6582-1.3304 21.4687-12.2105 8.8105-10.88 105.7428-238.6345L958.3778 13.0307 809.4566 632.3235q-5.1106 19.0232 11.2095 32.239 10.88 8.8105 23.5382 7.48l90.0139-9.4608q12.6582-1.3304 21.4687-12.2105 2.5174-3.1085 2.9988-5.2923l358.3411-669.7437 337.552-35.4781q209.5635-22.0259 264.3143-89.6377 20.1382-24.8686 17.1077-53.7012-3.0304-28.8326-27.8992-48.9709z" fill="#000000"/>
// </svg>`;
// var svgElementBounds = [ [ 32.885238,-80.03826], [32.884713,-80.038016 ] ];
// L.svgOverlay(svgElement, svgElementBounds).addTo(map);

const early = ["A1", "B2"];
const late = ["B9", "B10"];
const hidden = ["A2A"];
Object.entries(chsGatePlanes).forEach(([key, { svg, bounds }]) => {
  var svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  svgElement.innerHTML = svg;
  svgElement.classList.add(`plane-${key}`);

  // If the key is in the 'early' list, change fill to green
  if (early.includes(key)) {
    svgElement.querySelectorAll("path").forEach(path => {
      path.setAttribute("fill", "#50C878");
    });
  }

  if (late.includes(key)) {
    svgElement.querySelectorAll("path").forEach(path => {
      path.setAttribute("fill", "#880808");
    });
  }

  if (hidden.includes(key)) {
    svgElement.style.display = "none"; // Completely hides the SVG
  }

  L.svgOverlay(svgElement, bounds).addTo(map);
});


return {L,div,map,early,late,hidden};
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link observablehq-link-active"><a href="./">Charleston International Airport</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./arrivals">Arrivals</a></li>
    <li class="observablehq-link"><a href="./chs">CHS Code</a></li>
    <li class="observablehq-link"><a href="./departures">Departures</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="charleston-international-airport" tabindex="-1"><a class="observablehq-header-anchor" href="#charleston-international-airport">Charleston International Airport</a></h1>
<p><a href="https://github.com/bradfordjohnson/kchs/actions/workflows/etl-flight-data.yaml" target="_blank" rel="noopener noreferrer"><img src="https://github.com/bradfordjohnson/kchs/actions/workflows/etl-flight-data.yaml/badge.svg" alt="ETL Flight Data"></a>
<a href="https://github.com/bradfordjohnson/kchs/actions/workflows/dashboard-deploy.yml" target="_blank" rel="noopener noreferrer"><img src="https://github.com/bradfordjohnson/kchs/actions/workflows/dashboard-deploy.yml/badge.svg" alt="Deploy dashboard to Pages"></a></p>
<p>Built with Observable Framework, this dashboard provides a dynamic, data-driven view of Charleston International Airport (KCHS) flight activity. It combines JavaScript-powered visuals, data mapping and fetching with a Python-based ETL pipeline that collects daily flight snapshots for historical views.</p>
<h2 id="features" tabindex="-1"><a class="observablehq-header-anchor" href="#features">Features</a></h2>
<ul>
<li>Daily flight metrics and trends for arrivals and departures
<ul>
<li>WoW delta comparisons</li>
</ul>
</li>
<li>Arrivals and departures "boards", showing flights, statuses, and more.</li>
</ul>
<h3 id="features-in-development" tabindex="-1"><a class="observablehq-header-anchor" href="#features-in-development">Features in development</a></h3>
<ul>
<li>Live gate map – a Leaflet-based gate map with SVG plane overlays to track &amp; visualize real-time in-gate performance</li>
<li>Main interactive dashboard page with historical and live data
<ul>
<li>dimensional filters, metric performance and trends</li>
</ul>
</li>
</ul>
<h3 id="todo" tabindex="-1"><a class="observablehq-header-anchor" href="#todo">TODO</a></h3>
<ul>
<li>Create data model and logic to determine what flights are in the gate at a given time</li>
</ul>
<hr>
<h2 id="todays-flights" tabindex="-1"><a class="observablehq-header-anchor" href="#todays-flights">Today's Flights</a></h2>
<!-- <div class="chip-description">
  <div class="chip-caption">
  See page:
  </div>
  <a href="/arrivals" class="chip">
  Arrivals
  </a>
  <a href="/departures" class="chip">
  Departures
  </a>
</div> -->
<div class="observablehq observablehq--block"><!--:52cf6696:--></div>
<div class="observablehq observablehq--block"><!--:c4a984e5:--></div>
<div class="grid grid-cols-4" style="grid-auto-rows: auto;">
  <div class="card">
    <h2>Arrivals</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:b6dc4393:--></span>
    <span class="small"><observablehq-loading></observablehq-loading><!--:b1c49502:-->% WoW Δ</span>
    <br>
    <span><observablehq-loading></observablehq-loading><!--:e7f0e3f0:--></span>
  </div>
  <div class="card">
    <h2>Departures</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:58cc44fe:--></span>
    <span class="small"><observablehq-loading></observablehq-loading><!--:690fccba:-->% WoW Δ</span>
    <br>
    <span><observablehq-loading></observablehq-loading><!--:aa732f1e:--></span>
  </div>
</div>
<div class="observablehq observablehq--block"><!--:952072bf:--></div>
<div class="observablehq observablehq--block"><!--:2a551b63:--></div>
<div class="observablehq observablehq--block"><!--:a5d4d7c8:--></div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-02-20T08:54:13">Feb 20, 2025</a>.</div>
</footer>
</div>
</body>
</html>
